<!DOCTYPE html>
<html>
<body>
<script src="https://cdn.netpie.io/microgear.js"></script>
<script>
  const APPID = "PetFeederEmbedded";
  const KEY = "caWCt2LSx95Pb13";
  const SECRET = "5UjGfLFdLyQiqPx97ElSOuX9H";

  const ALIAS = "HTML_web";         //  ชื่อตัวเอง
  const thing1 = "NodeMCU1";          //  ชื่อเพื่อนที่จะคุย

  function switchPress(logic){
    if(logic == 1 ){
      microgear.chat(thing1,"ON");
    }else if(logic == 0 ){
      microgear.chat(thing1,"OFF");
    }
  }
  
  function myFunction() {
 
  var newAmount = document.getElementById("newAmount").value;
  var newEmail = document.getElementById("newEmail").value;

  if (newAmount == '' || newEmail == '') {
	alert("Please Enter All Information");
  }
  else {
        var meassage = newAmount + "/" + newEmail;
  	microgear.chat(thing1,meassage);
  }

  

  }

  var microgear = Microgear.create({
    key: KEY,
    secret: SECRET,
    alias : ALIAS
  });

  microgear.on('message',function(topic,msg) {
    document.getElementById("raw_data").innerHTML = "Data from Node MCU = " + msg;
    document.getElementById("get_topic").innerHTML = "Topic = " + topic;
    
    var split_msg = msg.split("/"); //String data = "/" +String(currentUltra) 
					//+ "/" + String(minUltra) "/" + String(status);
    
    if(typeof(split_msg[0])!='undefined' && split_msg[0]==""){
      document.getElementById("Humidity_temp").innerHTML = "Current amount = " + split_msg[1] 
							+ " % ,Minimum amount = " + split_msg[2] + " %";
    }

    var status = split_msg[3];
    if(status=="ON"){
           document.getElementById("Status").innerHTML =  "Load is ON.";
      }else if(status=="OFF"){
           document.getElementById("Status").innerHTML =  "Load is OFF."; 
      }
  });

  microgear.on('connected', function() {
    microgear.setAlias(ALIAS);
    document.getElementById("connected_NETPIE").innerHTML = "Connected to NETPIE"
  });

  microgear.on('present', function(event) {
    console.log(event);
  });

  microgear.on('absent', function(event) {
    console.log(event);
  });

  microgear.resettoken(function(err) {
    microgear.connect(APPID);
  });
</script>
<center>
<h1 id="connected_NETPIE"></h1>
<p id="raw_data"></p>
<p id="get_topic"></p>
<strong id="current-Ultra"></strong>
<strong id="min-Ultra"></strong>

<button type="button" onclick="switchPress(1)">Turn ON</button>
<button type="button" onclick="switchPress(0)">Turn OFF</button>
<p><strong id="Status">Load is OFF.</strong></p>

<form onsubmit="myFunction()">
	New amount:<br>
	<input type="text" id="newAmount">
	<br>
	Receiver E-mail:<br>
	<input type="text" id="newEmail">
	<br><br>
	<input type="submit">
</form>
</center>
</body>
</html>